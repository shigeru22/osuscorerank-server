# Authentication

Most routes for getting data don't require any authentication. However, routes that require authentication which is defined in [Endpoint section](2-endpoint.md) (also marked with **<ins>Auth</ins>** in route documentation) needs an access token for those operations.

This API uses JSON Web Token (JWT) for authentication, which is generated by providing client ID and client key. The credentials are provided in private basis, since only authorized user should access them.

## Development Environment Notes

Secret used for JWT is defined in `.env` file. The value must be hexadecimal string with 128 characters long. This could be generated using `crypto` module in Node.js by running this command.

```shell
> require('crypto').randomBytes(64).toString('hex')
'93db059c6f7f88ccf831726c24c08d07f8fa51770c562cec9130fe524c49d85300876f30b15d3751fee201d967d7dc1b82355d3459fb21bf50a1351da01ab374'
```

The string could be put in `TOKEN_SECRET` variable inside `.env` file without quotes. Credentials in the database (Auth database) can be filled with any name for logging purposes, with client key of 64 character hexadecimal string. This could be generated using the same command as before, but with `32` as random bytes argument.

## Authenticating

Authentication could be done by requesting a token using the following endpoint.

#### **POST** `/auth`

##### Request body (JSON):

```
{
  "clientId": string,
  "clientKey": string
}
```

`clientId` **string**

Client ID.

`clientKey` **string**

Client Key.

##### Response format (JSON):

```
{
  "message": string,
  "data": {
    "accessToken": string,
    "expiresIn": string
  }
}
```

##### Example response (200):

```json
{
  "message": "Authenticated successfully.",
  "data": {
    "accessToken": "your_JWT_here",
    "expiresIn": "1h"
  }
}
```

## Using token for authorization

After receiving your token, the token must be included in the **header** of those requests requiring authentication in the following format.

`Authorization: Bearer {token}`

> **Note:** Make sure to change `{token}` field with your generated token!

If authentication fails, the following response will be sent.

##### Example response (401):

```json
{
  "message": "Authentication failed. Check your access token and try again."
}
```

Otherwise, without any authentication, the following response will be sent.

##### Example response (401):

```json
{
  "message": "Authorization is not provided."
}
```

Every token has an expire time, retrieved in authentication response as in previous section. If the token has been expired and couldn't be used, the following response will be sent.

##### Example response (401):

```json
{
  "message": "Token expired. Please try again."
}
```

In that case, try to regenerate a new access token and retry with the new generated token.